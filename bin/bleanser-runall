#!/usr/bin/env bash
# runs all bleanser jobs

set -o pipefail
set -e

main() {
	local default_args args removed_dir
	removed_dir="${HOME}/.cache/removed"
	mkdir -p "${removed_dir}"
	default_args=(--move "${removed_dir}" --yes)
	for sort_type in size name; do
		prune_module() {
			local -a args=()
			local module_name
			args=("${default_args[@]}")
			args+=(--sort-by "$sort_type")
			module_name="${1?pass module name}"
			shift
			args+=("$@")
			python3 -m bleanser_sean.modules."${module_name}" prune "${args[@]}" || return $?
		}
		prune_module bash ~/data/bash || return $?
		prune_module bash ~/data/bash_history || return $?
		prune_module smscalls --glob ~/data/SMSBackups/'sms-*' || return $?
		prune_module smscalls --glob ~/data/SMSBackups/'calls-*' || return $?
		prune_module chess --glob ~/data/chess/'chessdotcom_2*' || return $?
		prune_module chess --glob ~/data/chess/'lichess_2*' || return $?
		prune_module trakt --glob ~/data/trakt/'2*' || return $?
		prune_module listenbrainz --glob ~/data/listenbrainz/'2*' || return $?
		prune_module zsh ~/data/zsh_history || return $?
		prune_module ipython ~/data/ipython || return $?
	done
}

main || exit $?
