#!/usr/bin/env bash
# runs all bleanser jobs

set -o pipefail
set -e

main() {
	local default_args args removed_dir
	removed_dir="${HOME}/.cache/removed"
	mkdir -p "${removed_dir}"
	default_args=(--move "${removed_dir}" --yes)
	for sort_type in size name; do
		args=("${default_args[@]}")
		args+=(--sort-by "$sort_type")
		for bash_dirs in ~/data/bash ~/data/bash_history; do
			python3 -m bleanser_sean.modules.bash prune "${bash_dirs}" "${default_args[@]}"
		done
		for glob in 'sms-*' 'calls-*'; do
			python3 -m bleanser_sean.modules.smscalls prune --glob ~/data/SMSBackups/"${glob}" "${default_args[@]}"
		done
		for chess_glob in 'chessdotcom_2*' 'lichess_2*'; do
			python3 -m bleanser_sean.modules.chess prune --glob ~/data/chess/"${chess_glob}" "${default_args[@]}"
		done
		python3 -m bleanser_sean.modules.trakt prune --glob ~/data/trakt/'2*' "${default_args[@]}"
		python3 -m bleanser_sean.modules.listenbrainz prune --glob ~/data/listenbrainz/'2*' "${default_args[@]}"
		python3 -m bleanser_sean.modules.zsh prune ~/data/zsh_history "${default_args[@]}"
		python3 -m bleanser_sean.modules.ipython prune ~/data/ipython "${default_args[@]}"
	done
}

main || exit $?
